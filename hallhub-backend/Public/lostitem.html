<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Lost Item Form</title>
 <style>
   body {
     font-family: 'Segoe UI', sans-serif;
     background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
     display: flex;
     justify-content: center;
     align-items: center;
     height: 100vh;
     margin: 0;
   }
   .form-wrapper {
     background-color: white;
     padding: 30px;
     border-radius: 12px;
     box-shadow: 0 6px 16px rgba(0,0,0,0.2);
     width: 380px;
   }
   h2 {
     text-align: center;
     color: #333;
     margin-bottom: 20px;
   }
   label {
     display: block;
     margin-bottom: 8px;
     font-weight: 600;
   }
   input, textarea, select {
     width: 100%;
     padding: 10px;
     border: 1px solid #ccc;
     border-radius: 8px;
     margin-bottom: 16px;
     transition: 0.3s ease;
     box-sizing: border-box;
   }
   input:focus, textarea:focus, select:focus {
     border-color: #667eea;
     outline: none;
   }
   select {
     cursor: pointer;
   }
   button {
     width: 100%;
     background-color: #667eea;
     color: white;
     padding: 10px;
     font-size: 16px;
     border: none;
     border-radius: 8px;
     cursor: pointer;
     transition: 0.3s ease;
   }
   button:hover {
     background-color: #5a6fd8;
   }
   button:disabled {
     background-color: #ccc;
     cursor: not-allowed;
   }
   .msg {
     text-align: center;
     margin-top: 10px;
     font-size: 14px;
     color: #444;
     font-weight: 500;
   }
   .msg.success {
     color: #28a745;
   }
   .msg.error {
     color: #dc3545;
   }
   .loading {
     opacity: 0.6;
   }
 </style>
</head>
<body>
 <div class="form-wrapper">
   <h2>Lost Item Report</h2>
   <form id="lostForm">
     <label for="studentId">Student ID *</label>
     <input type="number" id="studentId" placeholder="Enter your student ID" required>
     
     <label for="itemId">Item Type *</label>
     <select id="itemId" required>
       <option value="">Loading item types...</option>
     </select>
     
     <label for="description">Item Description *</label>
     <textarea id="description" rows="3" placeholder="Describe the item (color, brand, distinctive features, etc.)" required></textarea>
     
     <label for="lostDate">Date Lost *</label>
     <input type="date" id="lostDate" required>
     
     <button type="submit" id="submitBtn">Submit Report</button>
     <div class="msg" id="submissionMsg"></div>
   </form>
 </div>

 <script>
   // Load item types when page loads
   document.addEventListener('DOMContentLoaded', async function() {
     // Set max date to today
     const today = new Date().toISOString().split('T')[0];
     document.getElementById('lostDate').setAttribute('max', today);

     // Load item types from the API
     await loadItemTypes();
   });

   async function loadItemTypes() {
     const itemSelect = document.getElementById('itemId');
     const msgElement = document.getElementById('submissionMsg');
     
     console.log('Loading item types...'); // Debug log
     
     try {
       console.log('Fetching from /api/item-types...'); // Debug log
       const response = await fetch('http://localhost:3000/api/item-types');
       const itemTypes = await response.json();
       
       console.log('Response status:', response.status); // Debug log
       console.log('Item types received:', itemTypes); // Debug log
       
       if (response.ok && Array.isArray(itemTypes)) {
         // Clear existing options
         itemSelect.innerHTML = '<option value="">Select an item type...</option>';
         
         // Add item types to dropdown
         itemTypes.forEach(item => {
           console.log('Adding item:', item); // Debug log
           const option = document.createElement('option');
           option.value = item.Item_ID;
           option.textContent = item.Item_Type;
           itemSelect.appendChild(option);
         });
         
         console.log('Dropdown populated successfully'); // Debug log
       } else {
         console.error('Invalid response:', response.status, itemTypes); // Debug log
         itemSelect.innerHTML = '<option value="">Failed to load item types</option>';
         msgElement.textContent = "Failed to load item types. Please refresh the page.";
         msgElement.className = "msg error";
       }
     } catch (error) {
       console.error('Error loading item types:', error);
       itemSelect.innerHTML = '<option value="">Error loading item types</option>';
       msgElement.textContent = "Error loading item types. Please refresh the page.";
       msgElement.className = "msg error";
     }
   }

   document.getElementById("lostForm").addEventListener("submit", async function(e) {
     e.preventDefault();
     
     const submitBtn = document.getElementById("submitBtn");
     const msgElement = document.getElementById("submissionMsg");
     const formWrapper = document.querySelector('.form-wrapper');
     
     // Disable submit button and show loading
     submitBtn.disabled = true;
     submitBtn.textContent = "Submitting...";
     formWrapper.classList.add('loading');
     msgElement.textContent = "";
     msgElement.className = "msg";
     
     // Get form data
     const formData = {
       studentId: document.getElementById("studentId").value.trim(),
       itemId: document.getElementById("itemId").value,
       description: document.getElementById("description").value.trim(),
       lostDate: document.getElementById("lostDate").value
     };
     
     console.log('Form data:', formData); // Debug log
     
     // Client-side validation
     if (!formData.studentId || !formData.itemId || !formData.description || !formData.lostDate) {
       msgElement.textContent = "Please fill in all required fields";
       msgElement.className = "msg error";
       resetSubmitButton();
       return;
     }

     try {
       // Send data to server
       const response = await fetch('http://localhost:3000/api/lostitems', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json',
         },
         body: JSON.stringify(formData)
       });
       
       const result = await response.json();
       console.log('Server response:', result); // Debug log
       
       if (result.success) {
         // Show success message
         msgElement.textContent = "✅ Lost item reported successfully!";
         msgElement.className = "msg success";
         
         // Reset form after success
         e.target.reset();
         
         // Reset item dropdown to default
         document.getElementById('itemId').value = "";
         
         // Show additional message
         setTimeout(() => {
           msgElement.textContent = "You can now close this window or report another item.";
         }, 3000);
         
       } else {
         // Show error message from server
         msgElement.textContent = "❌ " + (result.error || 'Failed to submit report');
         msgElement.className = "msg error";
       }
       
     } catch (error) {
       console.error('Error submitting form:', error);
       msgElement.textContent = "❌ Network error. Please check your connection and try again.";
       msgElement.className = "msg error";
     } finally {
       resetSubmitButton();
     }

     function resetSubmitButton() {
       submitBtn.disabled = false;
       submitBtn.textContent = "Submit Report";
       formWrapper.classList.remove('loading');
     }
   });
 </script>
</body>
</html>