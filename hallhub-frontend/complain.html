<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8" />
 <title>File a Complaint</title>
 <style>
   body {
     background: linear-gradient(to right, #d299c2, #fef9d7);
     font-family: 'Segoe UI', sans-serif;
     margin: 0;
     padding: 0;
     display: flex;
     flex-direction: column;
     align-items: center;
     min-height: 100vh;
     color: #333;
   }

   .header {
     font-size: 2rem;
     font-weight: bold;
     padding: 20px;
     text-align: center;
   }

   .form-container {
     background: rgba(255,255,255,0.6);
     backdrop-filter: blur(8px);
     padding: 30px;
     border-radius: 20px;
     box-shadow: 0 8px 24px rgba(0,0,0,0.1);
     width: 90%;
     max-width: 500px;
     margin-bottom: 20px;
   }

   .form-container h2 {
     text-align: center;
     margin-bottom: 20px;
   }

   input, textarea {
     width: 100%;
     padding: 12px;
     margin-bottom: 15px;
     border: none;
     border-radius: 12px;
     background: rgba(255,255,255,0.8);
     font-size: 1rem;
     box-sizing: border-box;
   }

   input:focus, textarea:focus {
     outline: none;
     background: rgba(255,255,255,0.95);
     box-shadow: 0 0 10px rgba(255, 110, 196, 0.3);
   }

   textarea {
     height: 100px;
     resize: vertical;
   }

   button {
     background: #ff6ec4;
     color: white;
     padding: 12px 25px;
     border: none;
     border-radius: 30px;
     font-weight: bold;
     cursor: pointer;
     width: 100%;
     transition: all 0.3s ease;
   }

   button:hover {
     background: #fc5c7d;
     transform: scale(1.05);
   }

   button:disabled {
     background: #ccc;
     transform: none;
     cursor: not-allowed;
   }

   .confirmation {
     background: rgba(255,255,255,0.5);
     border-left: 6px solid #6a82fb;
     padding: 15px;
     border-radius: 16px;
     width: 90%;
     max-width: 500px;
     box-shadow: 0 4px 12px rgba(0,0,0,0.1);
     margin-bottom: 20px;
     animation: fadeIn 0.8s ease;
   }

   .success { border-left: 6px solid #27ae60; background: rgba(39, 174, 96, 0.1); color: #27ae60; }
   .error   { border-left: 6px solid #e74c3c; background: rgba(231, 76, 60, 0.1); color: #e74c3c; }
   .loading { border-left: 6px solid #f39c12; background: rgba(243, 156, 18, 0.1); color: #f39c12; }

   @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

   .back-link { margin-top: 10px; }
   .back-link a {
     text-decoration: none;
     font-weight: bold;
     color: #0056b3;
     padding: 10px 20px;
     border-radius: 20px;
     background: rgba(255, 255, 255, 0.3);
     transition: all 0.3s ease;
   }
   .back-link a:hover {
     background: rgba(255, 255, 255, 0.6);
     text-decoration: none;
   }
 </style>
</head>
<body>
 <div class="header">‚ö†Ô∏è Submit a Complaint</div>
 <div class="form-container">
   <h2>Complaint Form</h2>
   <form id="complainForm">
     <input type="text" id="studentId" placeholder="Your Student ID" required />
     <input type="text" id="complaintTitle" placeholder="Complaint Title/Subject" required />
     <textarea id="complainDesc" placeholder="Write your complaint here..." required></textarea>
     <button type="submit" id="submitBtn">üöÄ Submit Complaint</button>
   </form>
 </div>

 <div id="confirmationBox"></div>

 <div class="back-link">
   <a href="/hallhub-frontend/dashb.html">‚Üê Back to Dashboard</a>
 </div>

 <script>
   const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');

   document.addEventListener('DOMContentLoaded', function() {
     if (currentUser.studentId) {
       document.getElementById('studentId').value = currentUser.studentId;
     } else {
       //alert('Please log in to file a complaint.');
       //window.location.href = '/';
       //return;
     }
   });

   document.getElementById("complainForm").addEventListener("submit", async function(e) {
     e.preventDefault();
     
     const submitBtn = document.getElementById('submitBtn');
     const studentId = document.getElementById("studentId").value.trim();
     const title = document.getElementById("complaintTitle").value.trim();
     const description = document.getElementById("complainDesc").value.trim();

     if (!studentId || !title || !description) {
       showMessage("‚ùå All fields are required!", "error");
       return;
     }

     submitBtn.disabled = true;
     submitBtn.textContent = 'Submitting...';
     showMessage('Submitting your complaint...', 'loading');

     try {
       const response = await fetch('http://localhost:3000/api/complaints', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({ title, description, student_id: studentId })
       });

       let result;
       try {
         result = await response.json();
       } catch {
         result = { error: "Unexpected server response" };
       }

       if (response.ok) {
         showMessage(`
           <h3>‚úÖ Complaint Submitted Successfully!</h3>
           <p><strong>Complaint ID:</strong> #${result.complaintId}</p>
           <p><strong>Title:</strong> ${title}</p>
           <p><strong>Status:</strong> Pending</p>
           <p><strong>Submitted by:</strong> ${studentId}</p>
           <p><em>You will be notified once your complaint is resolved.</em></p>
         `, 'success');

         document.getElementById("complainForm").reset();
         document.getElementById('studentId').value = currentUser.studentId;
       } else {
         showMessage(`‚ùå Error: ${result.error || 'Something went wrong.'}`, 'error');
       }

     } catch (error) {
       console.error('Error submitting complaint:', error);
       showMessage('‚ùå Failed to submit complaint. Please check your connection.', 'error');
     } finally {
       submitBtn.disabled = false;
       submitBtn.textContent = 'üöÄ Submit Complaint';
     }
   });

   function showMessage(message, type) {
     const confirmationDiv = document.getElementById('confirmationBox');
     confirmationDiv.innerHTML = `<div class="confirmation ${type}">${message}</div>`;
   }
 </script>
</body>
</html>
