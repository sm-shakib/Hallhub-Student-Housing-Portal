<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Found Items</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #A18CD1, #FBC2EB);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.2);
    }
    h2 {
      color: #333;
      margin-bottom: 20px;
      text-align: center;
    }
    .student-info {
      background: rgba(161, 196, 253, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      border-left: 4px solid #a1c4fd;
    }
    .student-info h3 {
      margin-top: 0;
      color: #333;
    }
    .stats-section {
      background: rgba(76, 175, 80, 0.1);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      border-left: 4px solid #4caf50;
      text-align: center;
    }
    .stats-section h3 {
      margin: 0 0 10px 0;
      color: #2e7d32;
    }
    .stats-badge {
      background: rgba(255, 255, 255, 0.7);
      padding: 10px 20px;
      border-radius: 20px;
      display: inline-block;
      font-weight: bold;
      color: #2e7d32;
    }
    .stats-badge.no-items {
      background: rgba(255, 152, 0, 0.2);
      color: #f57c00;
    }
    .stats-badge.has-items {
      background: rgba(76, 175, 80, 0.2);
      color: #2e7d32;
    }
    .loading {
      text-align: center;
      background-color: #e3f2fd;
      color: #1976d2;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    .error {
      text-align: center;
      background-color: #ffebee;
      color: #c62828;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    .no-items {
      text-align: center;
      background-color: #fff3e0;
      color: #f57c00;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    .found-item {
      background-color: #e8f5e8;
      border-left: 4px solid #4caf50;
      padding: 20px;
      margin: 15px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .item-title {
      color: #2e7d32;
      font-size: 18px;
      font-weight: bold;
      margin: 0;
    }
    .found-badge {
      background-color: #4caf50;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    .item-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .detail-item {
      padding: 8px;
      background-color: rgba(255,255,255,0.7);
      border-radius: 6px;
    }
    .detail-label {
      font-weight: bold;
      color: #2e7d32;
      display: block;
      margin-bottom: 4px;
    }
    .refresh-btn {
      background-color: #A18CD1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 20px;
      transition: background-color 0.3s ease;
    }
    .refresh-btn:hover {
      background-color: #8c75bb;
    }
    .refresh-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .back-link {
      text-align: center;
      margin-top: 20px;
    }
    .back-link a {
      text-decoration: none;
      font-weight: bold;
      color: #0056b3;
      padding: 10px 20px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }
    .back-link a:hover {
      background: rgba(255, 255, 255, 0.6);
      text-decoration: none;
    }
    .items-list-header {
      margin-bottom: 15px;
      color: #2e7d32;
      font-weight: bold;
      padding: 10px;
      background: rgba(76, 175, 80, 0.1);
      border-radius: 8px;
      text-align: center;
    }
    @media (max-width: 600px) {
      .item-details {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üì¶ My Found Items</h2>
    
    <!-- User Info Section -->
    <div class="student-info">
      <h3>Student Information</h3>
      <div id="studentInfo">Loading student information...</div>
    </div>
    
    <!-- Found Items Statistics -->
    <div class="stats-section">
      <h3>üìä Found Items Statistics</h3>
      <div id="foundItemsStats">
        <div class="stats-badge">
          Total Found Items: <span id="foundItemsCount">0</span>
        </div>
      </div>
    </div>
    
    <!-- <button class="refresh-btn" id="refreshBtn" onclick="loadFoundItems()">üîÑ Refresh</button> -->
    
    <div id="itemsContainer">
      <div class="loading">Loading your found items...</div>
    </div>
  </div>

  <div class="back-link">
    <a href="dashb.html">‚Üê Back to Dashboard</a>
  </div>

  <script>
    let currentUser = null;

    // Get student session data same way as complaints page
    function initializeUser() {
      const sessionData = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
      
      if (!sessionData) {
        // For demo purposes, create mock user data (remove this in production)
        currentUser = {
          name: 'Demo User',
          studentId: '12345',
          email: 'demo@university.edu'
        };
        console.log('Using demo user data for testing');
      } else {
        try {
          currentUser = JSON.parse(sessionData);
          console.log('User session loaded:', currentUser);
        } catch (e) {
          console.error('Error parsing session data:', e);
          return false;
        }
      }
      return true;
    }

    function updateFoundItemsStats(count) {
      const countElement = document.getElementById('foundItemsCount');
      const statsElement = document.getElementById('foundItemsStats');
      
      countElement.textContent = count;
      
      // Update the stats section styling based on count
      if (count > 0) {
        statsElement.innerHTML = `
          <div class="stats-badge has-items">
            ‚úÖ Total Found Items: <span style="font-size: 1.2em; font-weight: bold;">${count}</span>
          </div>
        `;
      } else {
        statsElement.innerHTML = `
          <div class="stats-badge no-items">
            üì≠ Total Found Items: <span style="font-size: 1.2em; font-weight: bold;">0</span>
          </div>
        `;
      }
    }

    function loadFoundItems() {
      const container = document.getElementById('itemsContainer');

      if (!currentUser || !currentUser.studentId) {
        container.innerHTML = '<div class="error">‚ùå No user session found. Please log in again.</div>';
        updateFoundItemsStats(0);
        return;
      }

      const studentId = currentUser.studentId;

      // Show loading state
      container.innerHTML = '<div class="loading">üîç Loading your found items...</div>';

      // Fetch found items for the logged-in student
      fetch(`http://localhost:3000/api/student-found-items/${studentId}`)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          displayFoundItems(data);
        })
        .catch(error => {
          console.error('Fetch error:', error);
          container.innerHTML = '<div class="error">‚ùå Error loading found items. Please check your connection and try again.</div>';
          updateFoundItemsStats(0);
        });
    }

    function displayFoundItems(items) {
      const container = document.getElementById('itemsContainer');

      // Update statistics
      const foundItemsCount = items ? items.length : 0;
      updateFoundItemsStats(foundItemsCount);

      if (!items || items.length === 0) {
        container.innerHTML = `
          <div class="no-items">
            <h3>üì≠ No Found Items Yet</h3>
            <p>None of your lost items have been found yet. Keep checking back!</p>
            <p>If you haven't reported a lost item yet, you can <a href="lost-item-form.html" style="color: #A18CD1;">report it here</a>.</p>
          </div>
        `;
        return;
      }

      let html = `
        <div class="items-list-header">
          Showing ${foundItemsCount} found item${foundItemsCount === 1 ? '' : 's'}:
        </div>
      `;
      
      items.forEach(item => {
        html += `
          <div class="found-item">
            <div class="item-header">
              <h3 class="item-title">${item.Item_Type || 'Unknown Item'}</h3>
              <span class="found-badge">‚úÖ FOUND</span>
            </div>
            
            <div class="item-details">
              <div class="detail-item">
                <span class="detail-label">Description:</span>
                ${item.Description || 'No description available'}
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Lost Date:</span>
                ${item.Lost_Time ? new Date(item.Lost_Time).toLocaleDateString() : 'Unknown'}
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Found Date:</span>
                ${item.Found_Time ? new Date(item.Found_Time).toLocaleDateString() : 'Unknown'}
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Found ID:</span>
                ${item.Found_ID || 'N/A'}
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Lost ID:</span>
                ${item.Lost_ID || 'N/A'}
              </div>
              
              <div class="detail-item">
                <span class="detail-label">Status:</span>
                <span style="color: #4caf50; font-weight: bold;">Ready for Pickup</span>
              </div>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Initialize user and load items when page loads
    document.addEventListener('DOMContentLoaded', function() {
      if (initializeUser()) {
        // Show student info
        document.getElementById('studentInfo').innerHTML = `
          <strong>Name:</strong> ${currentUser.name}<br>
          <strong>ID:</strong> ${currentUser.studentId}<br>
          <strong>Email:</strong> ${currentUser.email}
        `;
        
        loadFoundItems();
      } else {
        document.getElementById('itemsContainer').innerHTML = 
          '<div class="error">‚ùå Failed to load user session. Please log in again.</div>';
        updateFoundItemsStats(0);
      }
    });
  </script>
</body>
</html>