<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HallHub - Student Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Enable dark mode via class -->
  <script>
    tailwind.config = { darkMode: 'class' };

    // Apply saved theme before rendering
    if (localStorage.theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  </script>
  <style>
    /* Glass effect + neon shadow on hover */
    .glass-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      transition: all 0.3s ease-in-out;
      box-shadow: 0 4px 10px rgba(0, 255, 255, 0.1);
    }
    .glass-card:hover {
      box-shadow: 0 0 20px 3px rgba(0, 255, 255, 0.8);
      transform: translateY(-5px) scale(1.01);
      border-color: rgba(0, 255, 255, 0.6);
      background: rgba(0, 255, 255, 0.05);
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-sans transition-colors duration-300 flex flex-col min-h-screen">

  <!-- Header Section -->
  <header class="bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-indigo-700 dark:to-purple-900 text-white py-6 shadow-lg">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <h1 class="text-3xl font-bold">üè¢ HallHub</h1>
      <div class="flex items-center space-x-4">
        <nav>
          <a href="home.html" class="mx-4 hover:text-gray-200 dark:hover:text-gray-300 transition">Back to Home</a>
          <a href="register.html" class="mx-4 hover:text-gray-200 dark:hover:text-gray-300 transition">Register</a>
        </nav>
        <!-- Theme Toggle Button -->
        <button id="theme-toggle" class="px-3 py-1 bg-white/20 rounded hover:bg-white/30 transition">
          üåô
        </button>
      </div>
    </div>
  </header>

  <!-- Success/Error Message -->
  <div id="alert-message" class="hidden">
    <div class="container mx-auto px-4 py-3">
      <div id="alert-content" class="p-4 rounded-lg shadow-md">
        <p id="alert-text"></p>
      </div>
    </div>
  </div>

  <!-- Login Form Section -->
  <section class="flex-grow py-12 container mx-auto px-4">
    <div class="max-w-md mx-auto glass-card rounded-xl p-8 shadow-md">
      <h2 class="text-3xl font-bold text-gray-800 dark:text-white text-center mb-6">üîê Student Login</h2>
      
      <form id="login-form" class="space-y-6" novalidate>
        <div>
          <label for="student-id" class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">Student ID *</label>
          <input
            type="text"
            id="student-id"
            name="student-id"
            autocomplete="off"
            required
            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400 dark:bg-gray-700 dark:text-white transition-colors"
            placeholder="Enter your student ID"
          />
          <span class="text-red-500 text-sm hidden" id="student-id-error"></span>
        </div>
        
        <div>
          <label for="password" class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">Password *</label>
          <div class="relative">
            <input
              type="password"
              id="password"
              name="password"
              autocomplete="off"
              required
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400 dark:bg-gray-700 dark:text-white transition-colors pr-12"
              placeholder="Enter your password"
            />
            <button type="button" id="toggle-password" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors">
              üëÅÔ∏è
            </button>
          </div>
          <span class="text-red-500 text-sm hidden" id="password-error"></span>
        </div>
        
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <input
              type="checkbox"
              id="remember-me"
              name="remember-me"
              class="h-4 w-4 text-cyan-400 focus:ring-cyan-400 border-gray-300 dark:border-gray-600 rounded"
            />
            <label for="remember-me" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
              Remember me
            </label>
          </div>
          <div class="text-sm">
            <a href="#" class="font-medium text-cyan-400 hover:text-cyan-300 transition-colors">
              Forgot password?
            </a>
          </div>
        </div>
        
        <button
          type="submit"
          id="login-btn"
          class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-cyan-400 hover:to-blue-700 dark:from-blue-500 dark:hover:from-cyan-400 dark:hover:to-blue-600 text-white py-3 rounded-lg transition shadow-[0_0_10px_rgba(0,255,255,0.6)] hover:shadow-[0_0_20px_rgba(0,255,255,0.9)] hover:scale-[1.03] transform duration-300 ease-in-out font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <span id="login-text">Log In</span>
          <span id="login-spinner" class="hidden">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Logging in...
          </span>
        </button>
        
        <div class="text-center mt-6">
          <p class="text-gray-600 dark:text-gray-400">
            Don't have an account? 
            <a href="register.html" class="text-cyan-400 hover:text-cyan-300 font-semibold transition-colors">
              Register here
            </a>
          </p>
        </div>
      </form>
    </div>
  </section>

  <!-- Footer Section -->
  <footer class="bg-gray-800 dark:bg-gray-900 text-white py-6 border-t border-gray-700">
    <div class="container mx-auto px-4 text-center">
      <p class="mb-4 text-gray-300">¬© 2025 HallHub. All rights reserved.</p>
      <div class="flex justify-center space-x-4">
        <a href="#contact" class="hover:text-gray-200 dark:hover:text-gray-400 transition">Contact Us</a>
        <a href="#privacy" class="hover:text-gray-200 dark:hover:text-gray-400 transition">Privacy Policy</a>
        <a href="#terms" class="hover:text-gray-200 dark:hover:text-gray-400 transition">Terms of Service</a>
      </div>
    </div>
  </footer>

  <script>

    // Always clear session when visiting login page
localStorage.removeItem('userSession');
sessionStorage.removeItem('userSession');

    // Theme toggle script
    const themeToggleBtn = document.getElementById('theme-toggle');
    themeToggleBtn.textContent = document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';

    themeToggleBtn.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      if (document.documentElement.classList.contains('dark')) {
        localStorage.theme = 'dark';
        themeToggleBtn.textContent = '‚òÄÔ∏è';
      } else {
        localStorage.theme = 'light';
        themeToggleBtn.textContent = 'üåô';
      }
    });

    // Password visibility toggle
    const togglePasswordBtn = document.getElementById('toggle-password');
    const passwordInput = document.getElementById('password');

    togglePasswordBtn.addEventListener('click', () => {
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        togglePasswordBtn.textContent = 'üôà';
      } else {
        passwordInput.type = 'password';
        togglePasswordBtn.textContent = 'üëÅÔ∏è';
      }
    });

    // Utility functions
    function showAlert(message, type = 'success') {
      const alertMessage = document.getElementById('alert-message');
      const alertContent = document.getElementById('alert-content');
      const alertText = document.getElementById('alert-text');
      
      // Set colors based on type
      if (type === 'success') {
        alertContent.className = 'p-4 rounded-lg shadow-md bg-green-100 dark:bg-green-800 border border-green-400 dark:border-green-600';
        alertText.className = 'text-green-700 dark:text-green-200';
      } else {
        alertContent.className = 'p-4 rounded-lg shadow-md bg-red-100 dark:bg-red-800 border border-red-400 dark:border-red-600';
        alertText.className = 'text-red-700 dark:text-red-200';
      }
      
      alertText.textContent = message;
      alertMessage.classList.remove('hidden');
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        alertMessage.classList.add('hidden');
      }, 5000);
    }

    function showError(fieldId, message) {
      const field = document.getElementById(fieldId);
      const error = document.getElementById(fieldId + '-error');
      
      if (error) {
        error.textContent = message;
        error.classList.remove('hidden');
        field.classList.add('border-red-500', 'focus:ring-red-500');
        field.classList.remove('focus:ring-cyan-400');
      }
    }

    function clearError(fieldId) {
      const field = document.getElementById(fieldId);
      const error = document.getElementById(fieldId + '-error');
      
      if (error) {
        error.classList.add('hidden');
        field.classList.remove('border-red-500', 'focus:ring-red-500');
        field.classList.add('focus:ring-cyan-400');
      }
    }

    function clearAllErrors() {
      const errorFields = ['student-id', 'password'];
      errorFields.forEach(fieldId => clearError(fieldId));
    }

    function validateForm(formData) {
      let isValid = true;
      
      // Clear previous errors
      clearAllErrors();
      
      // Validate required fields
      if (!formData.studentId) {
        showError('student-id', 'Student ID is required');
        isValid = false;
      }
      
      if (!formData.password) {
        showError('password', 'Password is required');
        isValid = false;
      }
      
      return isValid;
    }

    function setLoading(isLoading) {
      const loginBtn = document.getElementById('login-btn');
      const loginText = document.getElementById('login-text');
      const loginSpinner = document.getElementById('login-spinner');
      
      if (isLoading) {
        loginBtn.disabled = true;
        loginText.classList.add('hidden');
        loginSpinner.classList.remove('hidden');
      } else {
        loginBtn.disabled = false;
        loginText.classList.remove('hidden');
        loginSpinner.classList.add('hidden');
      }
    }

    // Store user session
    function storeUserSession(userData, rememberMe = false) {
      const sessionData = {
        studentId: userData.studentId,
        name: userData.name,
        email: userData.email,
        loginTime: new Date().toISOString()
      };

      if (rememberMe) {
        localStorage.setItem('userSession', JSON.stringify(sessionData));
      } else {
        sessionStorage.setItem('userSession', JSON.stringify(sessionData));
      }
    }

    // Check if user is already logged in
    function checkExistingSession() {
      const sessionData = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
      
      if (sessionData) {
        try {
          const userData = JSON.parse(sessionData);
          // Check if session is still valid (optional: add expiration check)
          return userData;
        } catch (error) {
          // Invalid session data, clear it
          localStorage.removeItem('userSession');
          sessionStorage.removeItem('userSession');
        }
      }
      
      return null;
    }

    // Form submission logic
    const form = document.getElementById('login-form');
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Collect form data
      const formData = {
        studentId: document.getElementById('student-id').value.trim(),
        password: document.getElementById('password').value,
      };

      const rememberMe = document.getElementById('remember-me').checked;

      // Validate form
      if (!validateForm(formData)) {
        return;
      }

      setLoading(true);

      try {
        // Send login request to backend
        const response = await fetch('http://localhost:3000/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        });

        const result = await response.json();

        if (response.ok) {
          showAlert('Login successful! Redirecting to dashboard...', 'success');
          
          // Store user session
          storeUserSession(result.student, rememberMe);
          
          // Clear form
          form.reset();
          
          // Redirect to dashboard after short delay
          setTimeout(() => {
            window.location.href = 'dashb.html';
          }, 1500);
        } else {
          showAlert(result.error || 'Login failed. Please check your credentials.', 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showAlert('Failed to connect to the server. Please try again later.', 'error');
      } finally {
        setLoading(false);
      }
    });

    // Check for existing session on page load
    document.addEventListener('DOMContentLoaded', () => {
      const existingSession = checkExistingSession();
      
      if (existingSession) {
        showAlert('You are already logged in. Redirecting to dashboard...', 'success');
        setTimeout(() => {
          window.location.href = 'dashb.html';
        }, 2000);
      }
    });

    // Clear errors on input
    document.getElementById('student-id').addEventListener('input', () => {
      clearError('student-id');
    });

    document.getElementById('password').addEventListener('input', () => {
      clearError('password');
    });

    // Handle Enter key on form fields
    form.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        form.dispatchEvent(new Event('submit'));
      }
    });
  </script>
</body>
</html>